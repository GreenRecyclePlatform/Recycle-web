<div class="earnings-container">
  <!-- Header -->
  <div class="header-section">
    <div>
      <h1 class="page-title">Earnings</h1>
      <p class="page-subtitle">Track your recycling earnings and payment history</p>
    </div>
    <button class="download-btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
      </svg>
      Download Statement
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading payments...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <p class="error-message">{{ error }}</p>
    <button class="retry-button" (click)="retry()">Try Again</button>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && !error" class="content-wrapper">
    <!-- Summary Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-title">This Week</span>
          <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2D6A4F" stroke-width="2">
            <rect x="2" y="5" width="20" height="14" rx="2"/>
            <path d="M16 3v4M8 3v4M2 10h20"/>
          </svg>
        </div>
        <div class="stat-value">{{ formatAmount(getWeeklyEarnings(), 'usd') }}</div>
        <div class="stat-trend positive">
          <span>‚Üë 22.5%</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-title">This Month</span>
          <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0077B6" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </div>
        <div class="stat-value">{{ formatAmount(getMonthlyEarnings(), 'usd') }}</div>
        <div class="stat-trend positive">
          <span>‚Üë 28.3%</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-title">Last Month</span>
          <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
            <polyline points="17 6 23 6 23 12"/>
          </svg>
        </div>
        <div class="stat-value">{{ formatAmount(getLastMonthEarnings(), 'usd') }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <span class="stat-title">Total Earnings</span>
          <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FFA500" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
            <polyline points="17 21 17 13 7 13 7 21"/>
            <polyline points="7 3 7 8 15 8"/>
          </svg>
        </div>
        <div class="stat-value">{{ formatAmount(getTotalEarnings(), 'usd') }}</div>
      </div>
    </div>

    <!-- Payment Summary Cards -->
    <div class="payment-summary-grid">
      <div class="summary-card card-pending">
        <p class="summary-label">Pending Payment</p>
        <p class="summary-amount">{{ formatAmount(getPendingAmount(), 'usd') }}</p>
        <p class="summary-info">From {{ getPendingCount() }} completed pickups</p>
      </div>

      <div class="summary-card card-processing">
        <p class="summary-label">Processing</p>
        <p class="summary-amount">{{ formatAmount(getProcessingAmount(), 'usd') }}</p>
        <p class="summary-info">Expected in 2-3 days</p>
      </div>

      <div class="summary-card card-paid">
        <p class="summary-label">Paid Out</p>
        <p class="summary-amount">{{ formatAmount(getCompletedAmount(), 'usd') }}</p>
        <p class="summary-info">All time total</p>
      </div>
    </div>

    <!-- Payment History Table -->
    <div class="history-card">
      <div class="card-header">
        <h2 class="card-title">Payment History</h2>
      </div>
      <div class="card-content">
        <!-- Empty State -->
        <div *ngIf="filteredPayments.length === 0" class="empty-state">
          <div class="empty-icon">üì≠</div>
          <h3>No payment history yet</h3>
          <p>Start recycling to earn your first payout!</p>
        </div>

        <!-- Table -->
        <div *ngIf="filteredPayments.length > 0" class="table-wrapper">
          <table class="payments-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Pickup ID</th>
                <th>Material</th>
                <th>Weight</th>
                <th>Status</th>
                <th class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let payment of filteredPayments" (click)="openDetail(payment.paymentId)" class="table-row">
                <td>{{ formatDate(payment.requestedAt) }}</td>
                <td class="pickup-id">{{ payment.pickupRequestId }}</td>
                <td>{{ getMaterialType(payment) }}</td>
                <td>{{ getWeight(payment) }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(payment.paymentStatus)">
                    {{ payment.paymentStatus | titlecase }}
                  </span>
                </td>
                <td class="amount-cell">{{ formatAmount(payment.amount, payment.currency) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Payment Info Card -->
    <div class="info-card">
      <div class="info-content">
        <div class="info-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2D6A4F" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
            <polyline points="17 21 17 13 7 13 7 21"/>
            <polyline points="7 3 7 8 15 8"/>
          </svg>
        </div>
        <div class="info-text">
          <h3 class="info-title">Payment Information</h3>
          <p class="info-description">
            Payments are processed weekly and directly deposited to your registered bank account. 
            Pending payments from completed pickups will be included in the next payment cycle.
          </p>
          <button class="update-btn" (click)="updatePaymentDetails()">
            Update Payment Details
          </button>
        </div>
      </div>
    </div>
  </div>
</div>