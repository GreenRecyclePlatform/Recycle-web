<div class="details-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading payment details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">⚠️</div>
    <p class="error-message">{{ error }}</p>
    <div class="error-actions">
      <button class="retry-button" (click)="retry()">Try Again</button>
      <button class="back-button" (click)="goBack()">Back to Payments</button>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && !error && payment" class="content-wrapper">
    <!-- Header with Back Button -->
    <div class="header-section">
      <button class="back-btn" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Payments
      </button>
      <div class="header-actions">
        <button class="action-btn" (click)="downloadReceipt()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
          </svg>
          Download Receipt
        </button>
        <button class="action-btn secondary" (click)="contactSupport()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
          </svg>
          Contact Support
        </button>
      </div>
    </div>

    <!-- Payment Overview Card -->
    <div class="overview-card">
      <div class="overview-header">
        <div class="overview-left">
          <h1 class="payment-amount">{{ formatAmount(payment.amount, payment.currency) }}</h1>
          <p class="payment-id">Payment ID: {{ payment.paymentId }}</p>
        </div>
        <div class="overview-right">
          <span class="status-badge large" [ngClass]="getStatusClass(payment.paymentStatus)">
            <span class="status-icon">{{ getStatusIcon(payment.paymentStatus) }}</span>
            {{ payment.paymentStatus | titlecase }}
          </span>
        </div>
      </div>
      
      <div class="overview-timeline" *ngIf="payment.paymentStatus === 'completed'">
        <div class="timeline-item completed">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Requested</span>
            <span class="timeline-date">{{ formatDate(payment.requestedAt) }}</span>
          </div>
        </div>
        <div class="timeline-line"></div>
        <div class="timeline-item completed">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Approved</span>
            <span class="timeline-date">{{ formatDate(payment.approvedAt) }}</span>
          </div>
        </div>
        <div class="timeline-line"></div>
        <div class="timeline-item completed">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Completed</span>
            <span class="timeline-date">{{ formatDate(payment.completedAt) }}</span>
          </div>
        </div>
      </div>

      <div class="overview-timeline" *ngIf="payment.paymentStatus === 'pending'">
        <div class="timeline-item completed">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Requested</span>
            <span class="timeline-date">{{ formatDate(payment.requestedAt) }}</span>
          </div>
        </div>
        <div class="timeline-line pending"></div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Awaiting Approval</span>
            <span class="timeline-date">Pending</span>
          </div>
        </div>
      </div>

      <div class="overview-timeline" *ngIf="payment.paymentStatus === 'approved'">
        <div class="timeline-item completed">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Requested</span>
            <span class="timeline-date">{{ formatDate(payment.requestedAt) }}</span>
          </div>
        </div>
        <div class="timeline-line"></div>
        <div class="timeline-item completed">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Approved</span>
            <span class="timeline-date">{{ formatDate(payment.approvedAt) }}</span>
          </div>
        </div>
        <div class="timeline-line pending"></div>
        <div class="timeline-item">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <span class="timeline-label">Processing Payment</span>
            <span class="timeline-date">In Progress</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Details Grid -->
    <div class="details-grid">
      <!-- Payment Information -->
      <div class="detail-card">
        <div class="card-header">
          <h2 class="card-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="5" width="20" height="14" rx="2"/>
              <path d="M2 10h20"/>
            </svg>
            Payment Information
          </h2>
        </div>
        <div class="card-content">
          <div class="info-row">
            <span class="info-label">Payment ID</span>
            <span class="info-value">{{ payment.paymentId }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Pickup Request</span>
            <span class="info-value link" (click)="viewPickupDetails()">{{ payment.pickupRequestId }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Amount</span>
            <span class="info-value amount">{{ formatAmount(payment.amount, payment.currency) }}</span>
          </div>
          <div class="info-row" *ngIf="payment.stripePayoutId">
            <span class="info-label">Transaction ID</span>
            <span class="info-value code">{{ payment.stripePayoutId }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Status</span>
            <span class="status-badge small" [ngClass]="getStatusClass(payment.paymentStatus)">
              {{ payment.paymentStatus | titlecase }}
            </span>
          </div>
        </div>
      </div>

      <!-- Material Details -->
      <div class="detail-card">
        <div class="card-header">
          <h2 class="card-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 7h-9M14 17H5M17 17h3M9 7H4M15 12H4"/>
              <circle cx="17" cy="12" r="2"/>
              <circle cx="11" cy="7" r="2"/>
              <circle cx="16" cy="17" r="2"/>
            </svg>
            Material Details
          </h2>
        </div>
        <div class="card-content">
          <div class="info-row">
            <span class="info-label">Material Type</span>
            <span class="info-value">{{ payment.materialType || 'N/A' }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Weight</span>
            <span class="info-value">{{ payment.weight || 'N/A' }}</span>
          </div>
          <div class="info-row" *ngIf="payment.pricePerKg">
            <span class="info-label">Price per kg</span>
            <span class="info-value">{{ formatAmount(payment.pricePerKg, payment.currency) }}</span>
          </div>
          <div class="info-row" *ngIf="payment.driverName">
            <span class="info-label">Collected By</span>
            <span class="info-value">{{ payment.driverName }}</span>
          </div>
          <div class="info-row" *ngIf="payment.pickupAddress">
            <span class="info-label">Pickup Location</span>
            <span class="info-value">{{ payment.pickupAddress }}</span>
          </div>
        </div>
      </div>

      <!-- Timeline Card (Full Width) -->
      <div class="detail-card full-width">
        <div class="card-header">
          <h2 class="card-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            Payment Timeline
          </h2>
        </div>
        <div class="card-content">
          <div class="timeline-vertical">
            <div class="timeline-event">
              <div class="event-dot completed"></div>
              <div class="event-content">
                <span class="event-title">Payment Requested</span>
                <span class="event-time">{{ formatDate(payment.requestedAt) }}</span>
                <span class="event-description">Payout request submitted for pickup {{ payment.pickupRequestId }}</span>
              </div>
            </div>

            <div class="timeline-event" *ngIf="payment.approvedAt">
              <div class="event-dot completed"></div>
              <div class="event-content">
                <span class="event-title">Payment Approved</span>
                <span class="event-time">{{ formatDate(payment.approvedAt) }}</span>
                <span class="event-description" *ngIf="payment.adminId">Approved by admin {{ payment.adminId }}</span>
              </div>
            </div>

            <div class="timeline-event" *ngIf="payment.completedAt">
              <div class="event-dot completed"></div>
              <div class="event-content">
                <span class="event-title">Payment Completed</span>
                <span class="event-time">{{ formatDate(payment.completedAt) }}</span>
                <span class="event-description">Funds transferred to your account</span>
              </div>
            </div>

            <div class="timeline-event" *ngIf="payment.paymentStatus === 'pending'">
              <div class="event-dot pending"></div>
              <div class="event-content">
                <span class="event-title">Awaiting Admin Review</span>
                <span class="event-time">Pending</span>
                <span class="event-description">Your payment is being reviewed by our team</span>
              </div>
            </div>

            <div class="timeline-event" *ngIf="payment.paymentStatus === 'approved'">
              <div class="event-dot pending"></div>
              <div class="event-content">
                <span class="event-title">Processing Payment</span>
                <span class="event-time">In Progress</span>
                <span class="event-description">Payment is being processed through Stripe</span>
              </div>
            </div>

            <div class="timeline-event" *ngIf="payment.paymentStatus === 'failed' && payment.failureReason">
              <div class="event-dot failed"></div>
              <div class="event-content">
                <span class="event-title">Payment Failed</span>
                <span class="event-time">{{ formatDate(payment.createdAt) }}</span>
                <span class="event-description error">{{ payment.failureReason }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Notes (if available) -->
      <div class="detail-card full-width" *ngIf="payment.adminNotes">
        <div class="card-header">
          <h2 class="card-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10 9 9 9 8 9"/>
            </svg>
            Admin Notes
          </h2>
        </div>
        <div class="card-content">
          <p class="notes-text">{{ payment.adminNotes }}</p>
        </div>
      </div>
    </div>

    <!-- Help Card -->
    <div class="help-card">
      <div class="help-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2D6A4F" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
      </div>
      <div class="help-content">
        <h3 class="help-title">Need Help?</h3>
        <p class="help-description">
          If you have questions about this payment or notice any discrepancies, 
          our support team is here to help you.
        </p>
        <button class="support-btn" (click)="contactSupport()">Contact Support</button>
      </div>
    </div>
  </div>
</div>