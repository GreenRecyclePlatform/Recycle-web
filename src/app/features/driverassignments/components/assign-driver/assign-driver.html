<div class="app-layout">
  <div class="main-container">
    <div class="content-area">
      <div class="assign-driver-container">

        <!-- Header -->
        <div class="page-header">
          <h1 class="page-title">üöõ Assign Drivers</h1>
          <p class="page-subtitle">Assign approved requests to available drivers</p>
        </div>

        <div *ngIf="isLoading" class="text-center my-3">
          <div class="spinner-border text-success" role="status"></div>
          <p>Loading data...</p>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="error-message">
          <i class="icon icon-alert"></i>
          <span>{{ errorMessage }}</span>
        </div>

        <!-- Main Content -->
        <div class="content-grid" *ngIf="!isLoading">
          <!-- Approved Requests Section -->
          <div class="requests-section">
            <h2 class="section-title">Approved Requests</h2>

            <div class="requests-list" *ngIf="approvedRequests.length > 0">
              <div
                *ngFor="let request of approvedRequests"
                class="request-card"
                [class.selected]="selectedRequest?.id === request.id"
                (click)="selectRequest(request)">

                <div class="request-header">
                  <div class="request-id-wrapper">
                    <span class="label">Request ID</span>
                    <span class="request-id">{{ request.id }}</span>
                  </div>
                  <span class="status-badge">{{ request.status }}</span>
                </div>

                <div class="request-details">
                  <div class="detail-item">
                    <i class="icon icon-user"></i>
                    <span>{{ request.customerName }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="icon icon-location"></i>
                    <span>{{ request.address }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="icon icon-box"></i>
                    <span>{{ request.material }} - {{ request.weight }} kg</span>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="approvedRequests.length === 0" class="empty-state">
              <p>No approved requests available</p>
            </div>
          </div>

          <!-- Available Drivers Section -->
          <div class="drivers-section">
            <h2 class="section-title">Available Drivers</h2>

            <div class="drivers-list" *ngIf="availableDrivers.length > 0">
              <div *ngFor="let driver of availableDrivers" class="driver-card">
                <div class="driver-header">
                  <div class="driver-avatar" *ngIf="!driver.profileImageUrl">
                    {{ driver.initials }}
                  </div>
                  <img
                    *ngIf="driver.profileImageUrl"
                    [src]="driver.profileImageUrl"
                    [alt]="driver.name"
                    class="driver-avatar-img"
                    (error)="onImageError($event)">

                  <div class="driver-info">
                    <h3 class="driver-name">{{ driver.name }}</h3>
                    <div class="driver-rating">
                      <i class="icon icon-star"></i>
                      <span>{{ driver.rating }}</span>
                    </div>
                  </div>
                </div>

                <div class="driver-details">
                  <div class="detail-item">
                    <i class="icon icon-location"></i>
                    <span>{{ driver.currentLocation }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="icon icon-phone"></i>
                    <span>{{ driver.phone }}</span>
                  </div>
                  <div class="detail-item">
                    <i class="icon icon-calendar"></i>
                    <span>All Pickups: {{ driver.todayPickups }}</span>
                  </div>
                </div>

                <button
                  class="btn-assign"
                  [disabled]="!selectedRequest"
                  (click)="assignToDriver(driver)">
                  Assign to This Driver
                </button>
              </div>
            </div>

            <div *ngIf="availableDrivers.length === 0" class="empty-state">
              <p>No available drivers at the moment</p>
            </div>
          </div>
        </div>

        <!-- Refresh Button -->
        <button class="btn-refresh" (click)="refreshData()">
          <i class="icon icon-refresh"></i>
          Refresh Data
        </button>

        <!-- Confirmation Modal -->
        <div class="modal fade show d-block" *ngIf="showConfirmModal" tabindex="-1" style="background-color: rgba(0,0,0,0.5);" (click)="cancelAssignment()">
          <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
            <div class="modal-content shadow-lg border-0">
              <div class="modal-header border-0 flex-column pb-0">
                <div class="modal-icon confirm-icon mb-3">‚ùì</div>
                <h5 class="modal-title fw-bold fs-4">Confirm Assignment</h5>
              </div>
              <div class="modal-body text-center px-4 py-3">
                <p class="text-muted mb-0">{{ modalMessage }}</p>
              </div>
              <div class="modal-footer border-0 justify-content-center pb-4">
                <button type="button" class="btn btn-secondary px-4 me-2" (click)="cancelAssignment()">Cancel</button>
                <button type="button" class="btn btn-success-custom px-4" (click)="confirmAssignment()">Confirm</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Success Modal -->
        <div class="modal fade show d-block" *ngIf="showSuccessModal" tabindex="-1" style="background-color: rgba(0,0,0,0.5);" (click)="closeSuccessModal()">
          <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
            <div class="modal-content shadow-lg border-0">
              <div class="modal-header border-0 flex-column pb-0">
                <div class="modal-icon success-icon mb-3">‚úì</div>
                <h5 class="modal-title fw-bold fs-4">Success!</h5>
              </div>
              <div class="modal-body text-center px-4 py-3">
                <p class="text-muted mb-0">{{ modalMessage }}</p>
              </div>
              <div class="modal-footer border-0 justify-content-center pb-4">
                <button type="button" class="btn btn-success-custom px-5" (click)="closeSuccessModal()">OK</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Error Modal -->
        <div class="modal fade show d-block" *ngIf="showErrorModal" tabindex="-1" style="background-color: rgba(0,0,0,0.5);" (click)="closeErrorModal()">
          <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
            <div class="modal-content shadow-lg border-0">
              <div class="modal-header border-0 flex-column pb-0">
                <div class="modal-icon error-icon mb-3">‚úï</div>
                <h5 class="modal-title fw-bold fs-4">Error</h5>
              </div>
              <div class="modal-body text-center px-4 py-3">
                <p class="text-muted mb-0">{{ modalMessage }}</p>
              </div>
              <div class="modal-footer border-0 justify-content-center pb-4">
                <button type="button" class="btn btn-danger px-5" (click)="closeErrorModal()">OK</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
