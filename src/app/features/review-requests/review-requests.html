<div class="container-fluid p-4">
  <!-- Header -->
  <div class="mb-4">
    <h2 class="page-title"> ‚è≥ Review Requests</h2>
    <p class="text-muted">Approve or reject pickup requests from users</p>
  </div>

  <!-- Status Filter -->
  <div class="card mb-4">
    <div class="card-body py-2">
      <select
        class="form-select status-filter"
        [(ngModel)]="statusFilter"
        (change)="onStatusChange()"
      >
        <option value="Waiting">Waiting</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Rejected">Rejected</option>
        <option value="Completed">Completed</option>
        <option value="PickedUp">PickedUp</option>
      </select>
    </div>
  </div>

  <!-- Requests Table -->
  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th width="40">
              <!-- <input type="checkbox" class="form-check-input" /> -->
            </th>
            <th>Request ID</th>
            <th>User</th>
            <th>Materials</th>
            <th>Total Weight</th>
            <th>Pickup Date</th>
            <th>Actions</th>
            <th width="40"></th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let request of WaitingRequests">
            <!-- Main Row -->
            <tr [class.expanded-row]="request.expanded">
              <td>
                <input type="checkbox" class="form-check-input" />
              </td>
              <td class="fw-medium">{{ request.id }}</td>
              <td>{{ request.userName }}</td>
              <td>
                <div class="materials-list">
                  <span
                    *ngFor="let material of request.requestMaterials; let last = last"
                    class="material-badge"
                  >
                    {{ material.materialName }}
                    <span *ngIf="!last">,</span>
                  </span>
                </div>
              </td>
              <td class="fw-medium">{{ getTotalWeight(request.requestMaterials) }}</td>
              <td>
                <div>{{ request.preferredPickupDate }}</div>
              </td>
              @if(this.statusFilter === 'Waiting'){

              <td>
                <div class="btn-group" role="group">
                  <button
                    class="btn btn-sm btn-success"
                    (click)="approveRequest(request)"
                    title="Approve"
                  >
                    <i class="bi bi-check-lg"></i>
                  </button>
                  <button
                    class="btn btn-sm btn-danger"
                    (click)="rejectRequest(request)"
                    title="Reject"
                  >
                    <i class="bi bi-x-lg"></i>
                  </button>
                  <!-- <button
                    class="btn btn-sm btn-outline-secondary"
                    (click)="editRequest(request)"
                    title="Edit"
                  >
                  <i class="bi bi-pencil"></i>
                </button> -->
                </div>
              </td>
              }
              <td>
                <button class="btn btn-sm btn-link text-dark" (click)="toggleExpand(request)">
                  <i
                    class="bi"
                    [ngClass]="request.expanded ? 'bi-chevron-up' : 'bi-chevron-down'"
                  ></i>
                </button>
              </td>
            </tr>

            <!-- Expanded Details Row -->
            <tr *ngIf="request.expanded" class="details-row">
              <td colspan="8">
                <div class="expanded-content">
                  <div class="row">
                    <!-- User Details -->
                    <div class="col-md-6">
                      <h6 class="section-title">User Details</h6>
                      <div class="detail-item">
                        <span class="detail-label">Name:</span>
                        <span class="detail-value">{{ request.userName }}</span>
                      </div>
                      <div class="detail-item">
                        <span class="detail-label">Phone:</span>
                        <span class="detail-value">{{ request.phoneNumber }}</span>
                      </div>
                      <div class="detail-item">
                        <span class="detail-label">Address:</span>
                        <span class="detail-value"
                          >{{ request.address.street }},{{ request.address.city }},{{
                            request.address.governorate
                          }}</span
                        >
                      </div>
                    </div>

                    <!-- Pickup Schedule -->
                    <div class="col-md-6">
                      <h6 class="section-title">Pickup Schedule</h6>
                      <div class="detail-item">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">{{ request.preferredPickupDate }}</span>
                      </div>
                      <!-- <div class="detail-item">
                        <span class="detail-label">Time Slot:</span>
                        <span class="detail-value">{{ request.pickupTime }}</span>
                      </div> -->
                    </div>
                  </div>

                  <!-- Materials Details -->
                  <div class="row mt-3">
                    <div class="col-12">
                      <h6 class="section-title">Materials Details</h6>
                      <div class="table-responsive">
                        <table class="table table-sm materials-table">
                          <thead>
                            <tr>
                              <th>Material Type</th>
                              <th>Weight</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let material of request.requestMaterials">
                              <td>{{ material.materialName }}</td>
                              <td>{{ material.estimatedWeight }}</td>
                            </tr>
                            <tr class="table-active fw-bold">
                              <td>Total</td>
                              <td>{{ getTotalWeight(request.requestMaterials) }}</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>

                  <!-- Material Photos -->
                  <!-- <div class="mt-3" *ngIf="request.photos.length > 0">
                    <h6 class="section-title">Material Photos</h6>
                    <div class="photo-gallery">
                      <div class="photo-item" *ngFor="let photo of request.photos">
                        <img [src]="photo" [alt]="'Material photo'" class="photo-img" />
                      </div>
                    </div>
                  </div> -->
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>
